@page "/scanner/barcode"
@using BlazorCameraStreamer
@using System.IO
@using Microsoft.Maui.Graphics

<CameraStreamer @ref="CameraStreamerReference"
                Width="1920"
                Height="1080"
                OnRendered="OnRenderedHandler"
                OnFrame="OnFrameHandler"
                Style="width: 480px; height: 270px;"
                CameraID="@cameraId"
                Autostart />

@code
{
    // ZXing.Net.Maui for scanning barcodes, this just makes the camera display
    CameraStreamer CameraStreamerReference;

    string cameraId = null;

    private async void OnRenderedHandler()
    {
        // Check camera-access or ask user, if it's not allowed currently
        if (await CameraStreamerReference.GetCameraAccessAsync())
        {
            // Reloading re-initializes the stream and starts the
            // stream automatically if the Autostart parameter is set
            await CameraStreamerReference.ReloadAsync();

            // If Autostart is not set, you have to manually start the stream again
            /* await CameraStreamerReference.StartAsync(); */
        }
    }

    private void OnFrameHandler(string data)
    {
        // Remove the suffix added by javascript
        data = data[(data.IndexOf(',') + 1)..];

        // Convert the base64 string to a Microsoft.Maui.Graphics.IImage
        // IImage image = LoadImageFromBase64(data);

        // Do something with the image
    }
}